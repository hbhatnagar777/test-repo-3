# -*- coding: utf-8 -*-# --------------------------------------------------------------------------# Copyright Commvault Systems, Inc.# See LICENSE.txt in the project root for# license information.# --------------------------------------------------------------------------""" It contains constants which will be used throughout the ring configuration for DB manipulation"""# query constantsINSERT_RING_QUERY = "INSERT INTO METALLICRINGINFO (RID, NAME) VALUES(%s, '%s')"INSERT_RING_INFRA_QUERY = "INSERT INTO METALLICRING%s (CLIENTID, NAME, CREATED, RID) " \                          "VALUES(%s, '%s', strftime('%s', 'now'), %s)"INSERT_RING_IS_QUERY = "INSERT INTO METALLICRING%s (INDEX_SERVER,CLIENTID, NAME, CREATED, RID) " \                       "VALUES('%s', %s, '%s', strftime('%s', 'now'), %s)"INSERT_RING_CONFIG_QUERY = "INSERT INTO METALLICRINGCONFIGMAP (state,startTime, RID, cid) " \                           "VALUES(%s, strftime('%s', 'now'), '%s', %s)"INSERT_RING_CONFIG_QUERY_V2 = "INSERT INTO METALLICRINGCONFIGMAP (state,startTime, endTime, RID, cid) " \                           "VALUES(%s, strftime('%s', 'now'), strftime('%s', 'now'), '%s', %s)"INSERT_WELCOME_MAIL_QUERY = "INSERT INTO METALLICRINGMAIL (rid, sentTime, sentTo) " \                            "VALUES('%s', strftime('%s', 'now'), '%s')"SELECT_RING_CONFIG_QUERY = "SELECT * FROM METALLICRINGCONFIGMAP WHERE RID = '%s' AND CID = %s"SELECT_RING_QUERY = "SELECT * FROM METALLICRINGINFO WHERE RID = %s AND NAME = '%s'"SELECT_RING_INFRA_QUERY = "SELECT * FROM METALLICRING%s WHERE RID = '%s' AND CLIENTID = %s"SELECT_RING_IS_QUERY = "SELECT * FROM METALLICRING%s WHERE RID = '%s' AND CLIENTID = %s AND INDEX_SERVER = '%s'"SELECT_RING_EMAIL_QUERY = "select b.name, a.state, a.startTime, a.endTime, a.errorDesc from MetallicRingConfigMap a " \                          "join MetallicRingConfig b on a.cid = b.id " \                          "where rid = '%s'"SELECT_WELCOME_MAIL_QUERY = "select sentTo, rid from MetallicRingMail where rid = '%s' and sentTo = '%s'"UPDATE_RING_CONFIG_QUERY = "update MetallicRingConfigMap " \                           "set state = %s, " \                           "endTime = strftime('%s', 'now')," \                           "errorDesc =  '%s'" \                           "where rid = '%s' and cid = %s"UPDATE_RERUN_RING_CONFIG_QUERY = "update MetallicRingConfigMap " \                                 "set state = %s, " \                                 "startTime = strftime('%s', 'now')," \                                 "endTime = 0," \                                 "errorDesc =  ''" \                                 "where rid = '%s' and cid = %s"UPDATE_RING_INFO_STATUS = "update MetallicRingInfo set status = %s " \                          "where name = '%s'"GET_SUBNET_QUERY = "SELECT subnet FROM MetallicHubSubnetInfo " \                   "WHERE rid is NULL LIMIT 1;"UPDATE_SUBNET_RING_QUERY = "UPDATE MetallicHubSubnetInfo " \                           "SET rid = '%s'" \                           "WHERE subnet = '%s'"GET_AVAILABLE_RING_QUERY = "SELECT rid, name FROM MetallicAvailableRing " \                           "WHERE status IS NULL LIMIT 1;"CHECK_USER_HAS_RING_QUERY = "SELECT rid, name, status FROM MetallicAvailableRing " \                            "where user = '%s' LIMIT 1;"UPDATE_AVAILABLE_RING_STATUS = "update MetallicAvailableRing " \                               "set status = %s, user = '%s' " \                                "where name = '%s'"GET_CLIENT_CONTAINER_FLAG = "SELECT TOP 1 attrval FROM App_ClientProp WITH (NOLOCK) " \                            "WHERE attrName = 'Container Client' AND componentNameId=%d"GET_COMMCELL_CLIENT = "SELECT name FROM MetallicRingCS WHERE rid='%d'"CLEANUP_AVAILABLE_RING_STATUS = "UPDATE MetallicAvailableRing SET user = NULL , status = NULL " \                                "WHERE rid = '%d'"CLEANUP_SUBNET_INFO = "UPDATE MetallicHubSubnetInfo SET rid=NULL WHERE rid = '%s'"DELETE_METALLIC_RING_CONFIG_MAP = "DELETE FROM MetallicRingConfigMap WHERE rid = '%s'"DELETE_METALLIC_RING_EMAIL = "DELETE FROM MetallicRingMail WHERE rid='%s'"DELETE_METALLIC_RING_CS = "DELETE FROM MetallicRingCS WHERE rid='%d'"DELETE_METALLIC_RING_MA = "DELETE FROM MetallicRingMA WHERE rid='%d'"DELETE_METALLIC_RING_WS = "DELETE FROM MetallicRingWS WHERE rid='%d'"DELETE_METALLIC_RING_WC = "DELETE FROM MetallicRingWC WHERE rid='%d'"DELETE_METALLIC_RING_IS = "DELETE FROM MetallicRingIS WHERE rid='%d'"DELETE_METALLIC_RING_NWP = "DELETE FROM MetallicRingNWP WHERE rid='%d'"DELETE_METALLIC_RING_INFO = "DELETE FROM MetallicRingInfo WHERE rid='%d'"# Task constantsADMIN_MAINTENANCE_TASK = 1ALERT_TASK = 2COMMCELL_TASK = 3CLIENT_GROUP_TASK = 4CLIENT_TASK = 5REPORT_TASK = 6MEDIA_AGENT_TASK = 7INDEX_SERVER_TASK = 8NETWORK_TASK = 9METRIC_SERVER_TASK = 10WORKFLOW_TASK = 11STORAGE_TASK = 12USER_TASK = 13USER_GROUP_TASK = 14VM_SNAP_TASK = 15ROLES_TASK = 16VM_CREATE_TASK = 17VM_CONFIG_TASK = 18VM_INSTALL_SW_TASK_CS = 19VM_INSTALL_SW_TASK_MA = 20VM_INSTALL_SW_TASK_WS = 21VM_INSTALL_SW_TASK_WC = 22VM_INSTALL_SW_TASK_NP = 23HUB_TERRAFORM_CLONE_TASK = 24HUB_TERRAFORM_CHECKOUT_TASK = 25HUB_TERRAFORM_UPDATE_TASK = 26HUB_TERRAFORM_DEPLOY_TASK = 27HUB_TERRAFORM_PUSH_TASK = 28HUB_RESOURCE_CREATE_BP_TASK = 29HUB_RESOURCE_CREATE_HP_TASK = 30HUB_RESOURCE_CREATE_BS_TASK = 31HUB_RESOURCE_CREATE_LISTENER_TASK = 32HUB_RESOURCE_CREATE_RULES_TASK = 33HUB_RESOURCE_CREATE_DNS_REC_TASK = 34HUB_CONFIG_CLONE_TASK = 35HUB_CONFIG_CHECKOUT_TASK = 36HUB_CONFIG_UPDATE_TASK = 37HUB_CONFIG_SET_ACCESS_POLICIES_TASK = 38HUB_CONFIG_PUSH_TASKS = 39HUB_CONFIG_WAIT_FOR_PR_COMPLETE_STAGE_I = 40HUB_CONFIG_UPDATE_LEAD_AND_LEGAL = 46HUB_PIPELINE_SET_CORS_ALLOWED_DOMAIN_TASK = 41HUB_PIPELINE_CREATE_VARIABLES_TASK = 42HUB_PIPELINE_UPDATE_FILE_DEFINITION_TASK = 43HUB_PIPELINE_UPDATE_RELEASE_DEFINITION_TASK = 44HUB_PIPELINE_RUN_PIPELINE_TASK_STAGE_1 = 45HUB_PIPELINE_RUN_PIPELINE_TASK_STAGE_2 = 47ADMIN_SYSTEM_TASK = 48HUB_CONFIG_WAIT_FOR_PR_COMPLETE_STAGE_II = 49HUB_TERRAFORM_WAIT_FOR_PR_COMPLETE_TASK = 50HUB_TERRAFORM_PUSH_TASK_STAGE_2 = 51HUB_POST_CONFIG_VALIDATOR = 52SMART_FOLDER_TASK = 53CONTAINER_TASK = 54LIGHT_HOUSE_TASK = 55CHECK_FUNC_APP_EXIST_TASK = 56# state constantsSTATE_STARTED = 0STATE_COMPLETE = 1STATE_PENDING = 2STATE_FAILED = -1# ring progress constantsRING_TASK_RUNNING = 0RING_TASK_COMPLETE = 1RING_TASK_COMPLETE_HUB_PENDING = 2RING_TASK_FAILED = -1RING_TASK_COMPLETE_WITH_ERRORS = -2NON_DEV_RING = "Non Dev Ring"