<App_SetCustomRuleRequest><queryDetail isQueryModifyEnabled="1" visibility="0" sqlQuery="SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED&#xA;&#xA;DECLARE @now INT= dbo.GetUnixTime(GETUTCDATE())&#xA;DECLARE @FilterInValid INT =0 &#xA;&#xA;DECLARE @TmpClientSubclientList TABLE&#xA;(ClientID      INT,&#xA; SubclientID   INT,&#xA; AppTypeID     INT,&#xA; SubCLientName NVARCHAR(500)&#xA;)&#xA;DECLARE @TMPSubclientFilterList TABLE&#xA;(ClientID    INT,&#xA; SubclientID INT&#xA;)&#xA;&#xA;IF isnull(@subclientname, '') &lt;&gt; ''&#xA;   OR isnull(@IdaName, '') &lt;&gt; ''&#xA;    BEGIN&#xA;        IF isnull(@subclientname, '') &lt;&gt; ''&#xA;           AND NOT EXISTS&#xA;        (&#xA;            SELECT 1&#xA;            FROM App_Application&#xA;            WHERE subclientName LIKE '%'+@subclientname+'%'&#xA;        )&#xA;            SELECT @FilterInValid = 1&#xA;        IF isnull(@IdaName, '') &lt;&gt; ''&#xA;           AND NOT EXISTS&#xA;        (&#xA;            SELECT 1&#xA;            FROM APP_iDAType&#xA;            WHERE name = @IdaName&#xA;        )&#xA;            SELECT @FilterInValid = 1&#xA;        IF @FilterInValid = 1&#xA;            RETURN&#xA;END&#xA;INSERT INTO @TmpClientSubclientList&#xA;       SELECT App.ClientID,&#xA;              App.id,&#xA;              App.appTypeId,&#xA;              App.subclientName&#xA;       FROM APP_ClientGroupAssoc CGA&#xA;            INNER JOIN @clientGroupList CGL ON CGL.entityId = CGA.clientGroupId&#xA;            INNER JOIN App_Application App ON App.clientId = CGA.clientId&#xA;       UNION&#xA;       SELECT EntityID ClientID,&#xA;              App.id,&#xA;              App.appTypeId,&#xA;              App.subclientName&#xA;       FROM @ClientList C&#xA;            INNER JOIN App_Application App ON App.clientId = C.EntityID&#xA;&#xA;&#xA;INSERT INTO @TMPSubclientFilterList&#xA;       SELECT clientID,&#xA;              SubclientID&#xA;       FROM&#xA;       (&#xA;           SELECT tmp.ClientID,&#xA;                  Tmp.SubCLientID,&#xA;                  Tmp.SubclientName&#xA;           FROM @TmpClientSubclientList Tmp&#xA;                JOIN APP_iDAType IDA ON IDA.type = Tmp.appTypeId&#xA;           WHERE Ida.name = isnull(@Idaname, ida.name)&#xA;       ) AS IDAFilter&#xA;       WHERE SubclientName LIKE '%'+ISNULL(@subclientname, '')+'%'&#xA;&#xA;&#xA;&#xA; SELECT app.ClientID,&#xA;       app.id SubclientID,&#xA;      CONVERT( varchar(25),dbo.GetDateTime(CAST(App_SubclientProp.attrval AS INTEGER)) ,25) AS LastBackupTime,&#xA;       App.appTypeId,&#xA;       App.backupSet,&#xA;       App.instance,&#xA;&#x9;   BkpSet.name AS BackupSetName,&#xA;       App.subclientname&#xA;FROM App_SubclientProp&#xA;     INNER JOIN App_Application App ON App.id = App_SubclientProp.componentNameId&#xA;&#x9; INNER JOIN APP_BackupSetName BkpSet ON BkpSet.id = App.backupSet&#xA;  INNER JOIN @TMPSubclientFilterList Tmp ON Tmp.ClientID = app.clientID&#xA;                                               AND Tmp.SubclientID = App.id&#xA;WHERE App_SubclientProp.attrName = N'Last Data Protected Time' --CV_PROP_BACKUP_NOTHING   &#xA;      AND App_SubclientProp.cs_attrname = CHECKSUM(N'Last Data Protected Time')&#xA;      AND App_SubclientProp.modified = 0&#xA;      AND ISNUMERIC(App_SubclientProp.attrval) = 1&#xA;      AND CAST(ROUND((@now - CONVERT(INT, App_SubclientProp.attrval)) / 60.00, 0) AS INT) &gt; @BackupThresholdinMins&#xA;      AND dbo.isBkpJobVisible(@userId, app.origCCID, app.clientId, app.appTypeid, app.instance, app.backupSet, app.id) = 1&#xA;      AND dbo.IsSubClientValid(app.appTypeId, app.subclientStatus, 0) = 1&#xA; AND (App.subclientStatus &amp; 6)=0 --- We dont want deleted and uninstalled subclients _CV_STATUS_DELETED| CV_STATUS_UNINSTALLED &#xA; UNION&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;--Include client which have no backups at all &#xA;&#xA;SELECT app.ClientID,&#xA;       app.id SubclientID,&#xA;       NULL AS LastBackupTime,&#xA;       App.appTypeId,&#xA;       App.backupSet,&#xA;       App.instance,&#xA;      BkpSet.name AS BackupSetName,&#xA;&#x9;  App.subclientName&#x9;  &#xA;FROM App_Application App &#xA;&#x9;INNER JOIN APP_BackupSetName BkpSet ON BkpSet.id = App.backupSet&#xA;     INNER JOIN @TMPSubclientFilterList Tmp ON Tmp.ClientID = app.clientID&#xA;                                               AND Tmp.SubclientID = App.id&#xA;    LEFT JOIN App_SubclientProp App_SubclientProp ON App.id = App_SubclientProp.componentNameId&#xA;                                                      AND App_SubclientProp.attrName = N'Last Data Protected Time'&#xA;WHERE App_SubclientProp.id IS NULL&#xA;    AND dbo.IsSubClientValid(app.appTypeId, app.subclientStatus, 0) = 1&#xA;     AND CAST(ROUND((@now - CONVERT(INT, app.reftime)) / 60.00, 0) AS INT) &gt; @BackupThresholdinMins&#xA; AND (App.subclientStatus &amp; 6)=0 --- We dont want deleted and uninstalled subclients _CV_STATUS_DELETED| CV_STATUS_UNINSTALLED  &#xA;   AND dbo.isBkpJobVisible(@userId, app.origCCID, app.clientId, app.appTypeid, app.instance, app.backupSet, app.id) = 1 &#xA;&#xA;&#x9;&#x9;   " doesQuerySupportOutputFilter="1" customAlertType="65" queryDescription="Custom Alert to notify clients which have not had backup completed in x Minutes" frequency="86400" isOverwriteAssociationAtAlertAllowed="0" isSystemCreated="0" queryCriteriaName="Clients not backed up for X minutes" taskInfoXml="&lt;TMMsg_TaskInfo&gt;&lt;task taskId=&quot;113&quot; taskName=&quot;&quot; taskType=&quot;2&quot; alertId=&quot;0&quot; ownerId=&quot;3&quot; runUserId=&quot;1&quot; description=&quot;&quot; ownerName=&quot;master&quot; policyType=&quot;10&quot; GUID=&quot;61bbd24b-1cd3-4de4-9535-e947bd45d788&quot; isRecoveryGroupOwner=&quot;0&quot; associatedObjects=&quot;0&quot;&gt;&lt;originalCC commCellId=&quot;2&quot;/&gt;&lt;taskFlags disabled=&quot;0&quot; uninstalled=&quot;0&quot; isEZOperation=&quot;0&quot; forDDB=&quot;0&quot; isEdgeDrive=&quot;0&quot; isSystem=&quot;0&quot; isIndexBackup=&quot;0&quot; isEdiscovery=&quot;0&quot; isServerPlanAssociated=&quot;0&quot;/&gt;&lt;task taskId=&quot;113&quot; taskName=&quot;&quot;/&gt;&lt;taskSecurity&gt;&lt;associatedUserGroups userGroupId=&quot;1&quot; userGroupName=&quot;master&quot; _type_=&quot;15&quot;/&gt;&lt;ownerCapabilities/&gt;&lt;advancedPrivacySettings authType=&quot;1&quot;&gt;&lt;passkeySettings enableAuthorizeForRestore=&quot;0&quot;&gt;&lt;expirationTime time=&quot;0&quot;/&gt;&lt;/passkeySettings&gt;&lt;/advancedPrivacySettings&gt;&lt;/taskSecurity&gt;&lt;securityAssociations&gt;&lt;ownerAssociations/&gt;&lt;tagWithCompany providerId=&quot;0&quot; providerDomainName=&quot;Commcell&quot;/&gt;&lt;/securityAssociations&gt;&lt;createAs&gt;&lt;user&gt;&lt;user userName=&quot;admin&quot; userId=&quot;1&quot;/&gt;&lt;/user&gt;&lt;/createAs&gt;&lt;/task&gt;&lt;appGroup/&gt;&lt;subTasks&gt;&lt;subTask subTaskId=&quot;117&quot; subTaskType=&quot;1&quot; operationType=&quot;5014&quot; flags=&quot;0&quot; subTaskOrder=&quot;0&quot; subTaskName=&quot;&quot;&gt;&lt;subTask subtaskId=&quot;117&quot; subtaskName=&quot;&quot;/&gt;&lt;/subTask&gt;&lt;options&gt;&lt;backupOpts backupLevel=&quot;2&quot;&gt;&lt;dataOpt autoCopy=&quot;0&quot;/&gt;&lt;/backupOpts&gt;&lt;commonOpts&gt;&lt;automaticSchedulePattern useStorageSpaceFromMA=&quot;0&quot;/&gt;&lt;/commonOpts&gt;&lt;/options&gt;&lt;pattern patternId=&quot;39&quot; name=&quot;&quot; flags=&quot;0&quot; freq_type=&quot;2048&quot; freq_interval=&quot;127&quot; freq_relative_interval=&quot;0&quot; freq_recurrence_factor=&quot;1&quot; freq_subday_interval=&quot;900&quot; skipOccurence=&quot;0&quot; skipDayNumber=&quot;0&quot; active_start_date=&quot;1518739200&quot; active_start_time=&quot;0&quot; active_end_date=&quot;0&quot; active_end_time=&quot;86340&quot; active_end_occurence=&quot;0&quot; description=&quot;Every week on Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday at 0:00   and repeats every 0 hr(s) 15 min(s) until 23:59 &quot; freq_restart_interval=&quot;0&quot;&gt;&lt;timeZone TimeZoneID=&quot;31&quot; TimeZoneName=&quot;(UTC-05:00) Eastern Time (US &amp;amp; Canada)&quot;/&gt;&lt;calendar calendarId=&quot;1&quot; calendarName=&quot;Standard&quot;/&gt;&lt;daysToRun week=&quot;0&quot; day=&quot;0&quot; Sunday=&quot;1&quot; Monday=&quot;1&quot; Tuesday=&quot;1&quot; Wednesday=&quot;1&quot; Thursday=&quot;1&quot; Friday=&quot;1&quot; Saturday=&quot;1&quot;/&gt;&lt;/pattern&gt;&lt;/subTasks&gt;&lt;/TMMsg_TaskInfo&gt;" isPrimaryKeyPresent="1" isDisabled="0"><creator userName="admin" userId="1" /><securityAssociations><ownerAssociations /><tagWithCompany providerId="0" providerDomainName="Commcell" /></securityAssociations><commcellAssociation /><additionalQueryDetails querySeverity="3" alertType="0" isHealthParam="0" alertCriteria="0"><externalQueryEntity _type_="125" /><scriptDescription reportName="Clients not backed up for X minutes" description="Custom Alert to notify clients which have not had backup completed in x Minutes" revision="$Revision: 1.1.2.7 $" guid="40FE7698-DEA4-4ECE-85C8-D7D2083613B2" /></additionalQueryDetails><queryEntity queryId="37" queryName="Clients not backed up for X minutes" /><queryParamsList><queryParamsList hidden="0" defaultValue="" displayName="Please enter the sub client name." className="java.lang.String" type="{http://www.w3.org/2001/XMLSchema}string" listType="0" required="0" inputName="subclientname" minimumValue="" inputType="java.lang.String" attribute="0" documentation="" controlHidden="0" readOnly="0" searchable="0" controlType="0" name="subclientname" maximumValue="" /><queryParamsList hidden="0" defaultValue="&lt;All&gt;" displayName="Please select client list to alert on." className="commvault.msgs.CvEntities.ClientEntity" type="{commvault.msgs.CvEntities}ClientEntity" listType="1" required="0" inputName="ClientList" minimumValue="" inputType="commvault.msgs.CvEntities.ClientEntity" attribute="0" documentation="" controlHidden="0" readOnly="0" searchable="0" controlType="2" name="ClientList" maximumValue=""><defaultValues val="&lt;All&gt;" /></queryParamsList><queryParamsList hidden="0" defaultValue="" displayName="Please select clientgroup list to alert on." className="commvault.msgs.CvEntities.ClientGroupEntity" type="{commvault.msgs.CvEntities}ClientGroupEntity" listType="1" required="0" inputName="clientGroupList" minimumValue="" inputType="commvault.msgs.CvEntities.ClientGroupEntity" attribute="0" documentation="" controlHidden="0" readOnly="0" searchable="0" controlType="2" name="clientGroupList" maximumValue="" /><queryParamsList hidden="0" defaultValue="" displayName="Please enter the app type." className="java.lang.String" type="{http://www.w3.org/2001/XMLSchema}string" listType="0" required="0" inputName="IDAName" minimumValue="" inputType="java.lang.String" attribute="0" documentation="" controlHidden="0" readOnly="0" searchable="0" controlType="0" name="IDAName" maximumValue="" /><queryParamsList hidden="0" defaultValue="15" displayName="Backup threshold (in minutes)." className="java.lang.Integer" type="{http://www.w3.org/2001/XMLSchema}integer" listType="0" required="1" inputName="BackupThresholdinMins" minimumValue="" inputType="java.lang.Integer" attribute="0" documentation="" controlHidden="0" readOnly="0" searchable="0" controlType="0" name="BackupThresholdinMins" maximumValue=""><defaultValues val="15" /></queryParamsList></queryParamsList><queryOutputColumns isColumnFilterable="0" lmDataType="14" isPrimaryKey="0" columnFriendlyName="Client name" columnName="ClientID"><supportedOpTypes val="9" /><columnAdditionalDetails isAlertRecipient="0" includeInAlertOutput="1" /></queryOutputColumns><queryOutputColumns isColumnFilterable="1" lmDataType="10" isPrimaryKey="1" columnFriendlyName="Subclient" columnName="SubclientID"><supportedOpTypes val="9" /><columnAdditionalDetails isAlertRecipient="0" includeInAlertOutput="0" /></queryOutputColumns><queryOutputColumns isColumnFilterable="0" lmDataType="1" isPrimaryKey="0" columnFriendlyName="Lastbackup Time" columnName="LastBackupTime"><supportedOpTypes val="2" /><supportedOpTypes val="3" /><supportedOpTypes val="0" /><supportedOpTypes val="1" /><columnAdditionalDetails isAlertRecipient="0" includeInAlertOutput="1" /></queryOutputColumns><queryOutputColumns isColumnFilterable="0" lmDataType="13" isPrimaryKey="0" columnFriendlyName="Application type" columnName="appTypeId"><supportedOpTypes val="9" /><columnAdditionalDetails isAlertRecipient="0" includeInAlertOutput="1" /></queryOutputColumns><queryOutputColumns isColumnFilterable="0" lmDataType="11" isPrimaryKey="0" columnFriendlyName="Backup set" columnName="backupSet"><supportedOpTypes val="9" /><columnAdditionalDetails isAlertRecipient="0" includeInAlertOutput="0" /></queryOutputColumns><queryOutputColumns isColumnFilterable="0" lmDataType="12" isPrimaryKey="0" columnFriendlyName="Instance" columnName="instance"><supportedOpTypes val="9" /><columnAdditionalDetails isAlertRecipient="0" includeInAlertOutput="1" /></queryOutputColumns><queryOutputColumns isColumnFilterable="1" lmDataType="1" isPrimaryKey="0" columnFriendlyName="BackupSet Name" columnName="BackupSetName"><supportedOpTypes val="2" /><supportedOpTypes val="3" /><supportedOpTypes val="0" /><supportedOpTypes val="1" /><columnAdditionalDetails isAlertRecipient="0" includeInAlertOutput="1" /></queryOutputColumns><queryOutputColumns isColumnFilterable="1" lmDataType="1" isPrimaryKey="0" columnFriendlyName="Subclient Name" columnName="subclientname"><supportedOpTypes val="2" /><supportedOpTypes val="3" /><supportedOpTypes val="0" /><supportedOpTypes val="1" /><columnAdditionalDetails isAlertRecipient="0" includeInAlertOutput="1" /></queryOutputColumns></queryDetail></App_SetCustomRuleRequest>